<% content_for :title, @organization.name %>

<div class="outer-container">
  <%= render 'organization_sidebar', organization: @organization %>

  <%#This page just shows the top-level organization fields %>

  <div class="organization-form">
    <dt>Last Updated</dt>
    <dd><%= l @organization.updated_at %></dd>

    <%= simple_form_for([:sfadmin, @organization]) do |form| %>
      <%= aasm_validation_errors_for(@organization) %>

      <h1>Edit "<%= @organization.name %>"</h1>

      <%= form.input :name %>
      <%= form.input :urls, as: :array %>
      <a href="#" onclick="add_field()">Add URL</a>
      <script>
        function add_field()
        {
          var form = $('.input.organization_urls')[0],
          input = document.createElement('input');
          input.setAttribute('class', 'text optional');
          input.setAttribute('id', 'organization_');
          input.setAttribute('name', 'organization[urls][]');
          input.setAttribute('type', 'text');
          form.appendChild(input);
        };
      </script>
      <%= form.submit %>

      <h2 class="sub-header"><%= Location.model_name.human.pluralize %></h2>
      <% @organization.locations.includes(:services).each do |location| %>
        <div class="panel panel-default">

          <div class="panel-heading">
            <h3 class="panel-title">
              <%= location.name %>
            </h3>
          </div>

          <div class="panel-body">
            <%= aasm_validation_errors_for(location) %>
            <%= render location %>
          </div>

          <% location.services.each do |service| %>
            <div class="panel-heading">
              <%= service.name %>
            </div>

            <div class="panel-body">
              <%= aasm_validation_errors_for(service) %>
              <%= render service %>
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
